<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>IRON: iron::ZLR Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IRON
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classiron_1_1ZLR.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classiron_1_1ZLR-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">iron::ZLR Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class implementing the zombie latency reduction algorithm.  
 <a href="classiron_1_1ZLR.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="zlr_8h_source.html">zlr.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a53456bd002d5a16ed1f8a1a5e39c6847"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#a53456bd002d5a16ed1f8a1a5e39c6847">ZLR</a> (<a class="el" href="classiron_1_1PacketPool.html">PacketPool</a> &amp;packet_pool, <a class="el" href="classiron_1_1BinMap.html">BinMap</a> &amp;bin_map, <a class="el" href="classiron_1_1BinQueueMgr.html">BinQueueMgr</a> &amp;q_mgr, <a class="el" href="namespaceiron.html#a9a5f420ded2cbb0ebfaf30509e0ce1d5">BinIndex</a> bin_index)</td></tr>
<tr class="separator:a53456bd002d5a16ed1f8a1a5e39c6847"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0c5c82b90a396e4a8d5836f51054453"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af0c5c82b90a396e4a8d5836f51054453"></a>
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#af0c5c82b90a396e4a8d5836f51054453">~ZLR</a> ()</td></tr>
<tr class="memdesc:af0c5c82b90a396e4a8d5836f51054453"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br /></td></tr>
<tr class="separator:af0c5c82b90a396e4a8d5836f51054453"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d2be582e0772b0379622871989b798b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#a3d2be582e0772b0379622871989b798b">Initialize</a> (const <a class="el" href="classiron_1_1ConfigInfo.html">ConfigInfo</a> &amp;config_info)</td></tr>
<tr class="memdesc:a3d2be582e0772b0379622871989b798b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> object.  <a href="#a3d2be582e0772b0379622871989b798b">More...</a><br /></td></tr>
<tr class="separator:a3d2be582e0772b0379622871989b798b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab55232db4283442cfffe447177e309ba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#ab55232db4283442cfffe447177e309ba">DoZLREnqueueProcessing</a> (uint16_t bytes, <a class="el" href="namespaceiron.html#a2603a9d5ad80707c1a0aa907c23833ad">LatencyClass</a> lat, <a class="el" href="namespaceiron.html#aacbb07180f64325df5439a0fcc7dae80">DstVec</a> dsts)</td></tr>
<tr class="memdesc:ab55232db4283442cfffe447177e309ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the change in bytes as applicable for this latency class.  <a href="#ab55232db4283442cfffe447177e309ba">More...</a><br /></td></tr>
<tr class="separator:ab55232db4283442cfffe447177e309ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af08e58708988159626b0baa1074135d2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#af08e58708988159626b0baa1074135d2">DoZLRDequeueProcessing</a> (const <a class="el" href="structiron_1_1DequeuedInfo.html">DequeuedInfo</a> &amp;dq_info)</td></tr>
<tr class="memdesc:af08e58708988159626b0baa1074135d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add zombies if necessary and track the removed bytes.  <a href="#af08e58708988159626b0baa1074135d2">More...</a><br /></td></tr>
<tr class="separator:af08e58708988159626b0baa1074135d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69c3588466c1f331be70f04222cf8e39"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classiron_1_1ZLR.html#a69c3588466c1f331be70f04222cf8e39">set_qd_xplot</a> (<a class="el" href="namespaceiron.html#a9a5f420ded2cbb0ebfaf30509e0ce1d5">BinIndex</a> bin_idx, <a class="el" href="classiron_1_1GenXplot.html">GenXplot</a> *qd_xplot)</td></tr>
<tr class="memdesc:a69c3588466c1f331be70f04222cf8e39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the pointer to the queue depth graph.  <a href="#a69c3588466c1f331be70f04222cf8e39">More...</a><br /></td></tr>
<tr class="separator:a69c3588466c1f331be70f04222cf8e39"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class implementing the zombie latency reduction algorithm. </p>
<p><a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> is intended to pad a queue with zombie packets that will never be sent, thus maintaining the same queue depths (for the purpose of backpressure and admission control) while decreasing the amount of time a real packet sits in the queue. To do this, we need to estimate the number of packets that are always in the queue (even if the queue depth is increasing and decreasing, there should be some minimum queue depth even during the dips) and replace those with zombies.</p>
<p>The <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> algorithm adds a zombie if and only if two conditions hold:</p><ol type="1">
<li>The queue depth is steady or increasing. We don't want to add zombies when the queue depth is decreasing, since that increases the likelihood that we'll end up eventually sending the zombies.</li>
<li>The minimum number of non-zombie packets sitting in the queue (even over queue depth dips) is still high. Both of these notions (is the queue depth decreasing? and what's the minimum number of packets in the queue?) are captured/maintained in the <a class="el" href="classiron_1_1QueueDepthDynamics.html" title="Class for tracking queue depth dynamics over a short time. ">QueueDepthDynamics</a> class. There are two instances of <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> at all times. One adds zombies based on the accumulation of all non-zombie packets according to the above algorithm. The other adds latency-sensitive zombies (the zombies aren't latency-sensitive, but they are paired with latency-sensitive traffic) based on the accumulation of ONLY latency-sensitive non-zombie data based on the above algorithm.</li>
</ol>
<p>DYNAMIC OBSERVATION WINDOW AND FAST RECOVERY:</p>
<p>Condition 2 above implies the existence of an observation window: how long into the past we will look to see what the minimum non-zombie depth has been. This observation window is dynamically adjusted. If zombies are sent or if there are (instantaneously) too few non-zombie packets in the queue, we will increase the size of that window (i.e., look further into the past when looking for the minimum non-zombie depth). This is because too few (or no) non-zombie packets means that we added too many zombies, and thus were likely looking at the wrong minimum non-zombie depth. If we've gone a long time without sending zombies, we slowly decrease the observation window size to increase reaction time.</p>
<p>In a real network, however, we may see occasional queue depth dips that do NOT mean we added too many zombies: they just mean some sort of blip happened in the network that caused our queue to temporarily dip. To account for these situations, <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> also includes a fast recovery algorithm.</p>
<p>Fast recovery watches when we're dequeuing packets to see if we're in the middle of a steep dequeue period. If so, we enter a fast recovery "Queue Depth Dip" stage - if we only see one dip, we will quickly increase our zombies back to the pre-dip level after the dip is complete. This helps quickly recover from a network blip. However, if two or more dips occur within a short time, we assume this is oscillatory, the zombie floor was incorrect, and thus we increase the observation window as discussed above. </p>

<p>Definition at line <a class="el" href="zlr_8h_source.html#l00116">116</a> of file <a class="el" href="zlr_8h_source.html">zlr.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a53456bd002d5a16ed1f8a1a5e39c6847"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ZLR::ZLR </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classiron_1_1PacketPool.html">PacketPool</a> &amp;&#160;</td>
          <td class="paramname"><em>packet_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classiron_1_1BinMap.html">BinMap</a> &amp;&#160;</td>
          <td class="paramname"><em>bin_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classiron_1_1BinQueueMgr.html">BinQueueMgr</a> &amp;&#160;</td>
          <td class="paramname"><em>q_mgr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceiron.html#a9a5f420ded2cbb0ebfaf30509e0ce1d5">BinIndex</a>&#160;</td>
          <td class="paramname"><em>bin_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">packet_pool</td><td>Reference to the packet pool. </td></tr>
    <tr><td class="paramname">bin_map</td><td>Reference to the bin map. </td></tr>
    <tr><td class="paramname">q_mgr</td><td>Reference to the <a class="el" href="classiron_1_1BinQueueMgr.html" title="The BinQueueMgr class stores and manages the queues for a. ">BinQueueMgr</a>. </td></tr>
    <tr><td class="paramname">bin_index</td><td>Bin on which this <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> instance is acting. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="zlr_8cc_source.html#l00237">237</a> of file <a class="el" href="zlr_8cc_source.html">zlr.cc</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="af08e58708988159626b0baa1074135d2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ZLR::DoZLRDequeueProcessing </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structiron_1_1DequeuedInfo.html">DequeuedInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>dq_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add zombies if necessary and track the removed bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dq_info</td><td>Information from the packet just dequeued. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="zlr_8cc_source.html#l00646">646</a> of file <a class="el" href="zlr_8cc_source.html">zlr.cc</a>.</p>

</div>
</div>
<a class="anchor" id="ab55232db4283442cfffe447177e309ba"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ZLR::DoZLREnqueueProcessing </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceiron.html#a2603a9d5ad80707c1a0aa907c23833ad">LatencyClass</a>&#160;</td>
          <td class="paramname"><em>lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceiron.html#aacbb07180f64325df5439a0fcc7dae80">DstVec</a>&#160;</td>
          <td class="paramname"><em>dsts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process the change in bytes as applicable for this latency class. </p>
<p>Note that this signature is asymmetric from DoZLRDequeueProcessing, which is necessary because we no longer own the packet after it's been enqueued (but we need a lot of data from the packet after a dequeue).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes</td><td>How many bytes were enqueued? uint16_t is sufficient because the total length field in the IP header is only 16 bits. By using uint16_t instead of uint32_t, we avoid the potential for overflow when converting to an int32_t to store the net change. </td></tr>
    <tr><td class="paramname">lat</td><td>The latency class of the bytes we enqueued. This function will determine based on this class whether and how to count these bytes towards the dynamics we're tracking. </td></tr>
    <tr><td class="paramname">dsts</td><td>The destinations for this packet, if multicast. Ignored if this <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> manager is for a unicast bin. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="zlr_8cc_source.html#l00520">520</a> of file <a class="el" href="zlr_8cc_source.html">zlr.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a3d2be582e0772b0379622871989b798b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ZLR::Initialize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classiron_1_1ConfigInfo.html">ConfigInfo</a> &amp;&#160;</td>
          <td class="paramname"><em>config_info</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the <a class="el" href="classiron_1_1ZLR.html" title="Class implementing the zombie latency reduction algorithm. ">ZLR</a> object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">config_info</td><td>The configuration information. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="zlr_8cc_source.html#l00313">313</a> of file <a class="el" href="zlr_8cc_source.html">zlr.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a69c3588466c1f331be70f04222cf8e39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void iron::ZLR::set_qd_xplot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespaceiron.html#a9a5f420ded2cbb0ebfaf30509e0ce1d5">BinIndex</a>&#160;</td>
          <td class="paramname"><em>bin_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classiron_1_1GenXplot.html">GenXplot</a> *&#160;</td>
          <td class="paramname"><em>qd_xplot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the pointer to the queue depth graph. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bin_idx</td><td>Bin for which we are assigning the graph. </td></tr>
    <tr><td class="paramname">qd_xplot</td><td>Pointer to the queue depth graph. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="zlr_8h_source.html#l00166">166</a> of file <a class="el" href="zlr_8h_source.html">zlr.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/szabele/github/IRON/iron/bpf/src/<a class="el" href="zlr_8h_source.html">zlr.h</a></li>
<li>/home/szabele/github/IRON/iron/bpf/src/<a class="el" href="zlr_8cc_source.html">zlr.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceiron.html">iron</a></li><li class="navelem"><a class="el" href="classiron_1_1ZLR.html">ZLR</a></li>
    <li class="footer">Generated on Fri Feb 26 2021 11:31:59 for IRON by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
