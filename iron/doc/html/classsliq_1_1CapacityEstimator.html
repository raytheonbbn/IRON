<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>IRON: sliq::CapacityEstimator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IRON
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classsliq_1_1CapacityEstimator.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classsliq_1_1CapacityEstimator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">sliq::CapacityEstimator Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A class that estimates the capacity of a connection to a peer.  
 <a href="classsliq_1_1CapacityEstimator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="sliq__capacity__estimator_8h_source.html">sliq_capacity_estimator.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a7bea5e74b76cb7c14056d3325b75b28d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7bea5e74b76cb7c14056d3325b75b28d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsliq_1_1CapacityEstimator.html#a7bea5e74b76cb7c14056d3325b75b28d">CapacityEstimator</a> ()</td></tr>
<tr class="memdesc:a7bea5e74b76cb7c14056d3325b75b28d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor. <br /></td></tr>
<tr class="separator:a7bea5e74b76cb7c14056d3325b75b28d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa25a347d5980382b2ec7ac8673ff7b5a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa25a347d5980382b2ec7ac8673ff7b5a"></a>
virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsliq_1_1CapacityEstimator.html#aa25a347d5980382b2ec7ac8673ff7b5a">~CapacityEstimator</a> ()</td></tr>
<tr class="memdesc:aa25a347d5980382b2ec7ac8673ff7b5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br /></td></tr>
<tr class="separator:aa25a347d5980382b2ec7ac8673ff7b5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ba7e5d9ce8810bbbc3c7bbff97daedb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsliq_1_1CapacityEstimator.html#a6ba7e5d9ce8810bbbc3c7bbff97daedb">Initialize</a> (<a class="el" href="namespacesliq.html#a9122e87208b802ee4c4a25c9a786f2a5">EndptId</a> conn_id)</td></tr>
<tr class="memdesc:a6ba7e5d9ce8810bbbc3c7bbff97daedb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the capacity estimator.  <a href="#a6ba7e5d9ce8810bbbc3c7bbff97daedb">More...</a><br /></td></tr>
<tr class="separator:a6ba7e5d9ce8810bbbc3c7bbff97daedb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d1c748a518227894d5c832d1bd37ed4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsliq_1_1CapacityEstimator.html#a0d1c748a518227894d5c832d1bd37ed4">InitCcAlg</a> (CcId cc_id, bool use_cwnd, size_t cwnd)</td></tr>
<tr class="memdesc:a0d1c748a518227894d5c832d1bd37ed4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a congestion control algorithm to be included in the capacity estimates.  <a href="#a0d1c748a518227894d5c832d1bd37ed4">More...</a><br /></td></tr>
<tr class="separator:a0d1c748a518227894d5c832d1bd37ed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2214baf5bc7998465dc4e8eb9118c8a7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsliq_1_1CapacityEstimator.html#a2214baf5bc7998465dc4e8eb9118c8a7">UpdateCapacityEstimate</a> (CcId cc_id, const <a class="el" href="classiron_1_1Time.html">iron::Time</a> &amp;now, size_t app_payload_bytes, size_t bytes_sent, size_t cwnd, double rate_est_bps, bool in_outage, double &amp;chan_ce_bps, double &amp;trans_ce_bps, double &amp;ccl_time_sec)</td></tr>
<tr class="memdesc:a2214baf5bc7998465dc4e8eb9118c8a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the capacity estimates.  <a href="#a2214baf5bc7998465dc4e8eb9118c8a7">More...</a><br /></td></tr>
<tr class="separator:a2214baf5bc7998465dc4e8eb9118c8a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A class that estimates the capacity of a connection to a peer. </p>
<p>This class is designed to track the capacity estimates for all of the congestion control algorithms in use by a single connection and consolidate them into a single connection capacity estimate. At startup, the <a class="el" href="classsliq_1_1CapacityEstimator.html#a6ba7e5d9ce8810bbbc3c7bbff97daedb" title="Initialize the capacity estimator. ">Initialize()</a> method must be called with the connection's endpoint identifier, and each congestion control algorithm must be initialized by calling the <a class="el" href="classsliq_1_1CapacityEstimator.html#a0d1c748a518227894d5c832d1bd37ed4" title="Initialize a congestion control algorithm to be included in the capacity estimates. ">InitCcAlg()</a> method with the algorithm's congestion window information. This information includes if the congestion window size should be used for estimating the capacity, and if so, what the initial congestion window size is in bytes. If the congestion window size should not be used, then a congestion control send rate estimate, as used for transmit pacing, must be used instead.</p>
<p>Once initialized, the <a class="el" href="classsliq_1_1CapacityEstimator.html#a2214baf5bc7998465dc4e8eb9118c8a7" title="Update the capacity estimates. ">UpdateCapacityEstimate()</a> method is called whenever one of the congestion control algorithms receives an ACK of a data packet that it allowed to be sent. The return value from this method indicates if the aggregated capacity estimate should be reported back to the application or not.</p>
<p>Capacity estimates are generated by observing the sizes of data packets that are ACKed during a collection interval. The collection interval duration is set to a constant time of 1 second. During each interval, two sizes are collected. The first is the total number of bytes sent on the channel that are ACKed (chan_acked_bytes). The second is the total number of transport payload bytes sent on the channel that are ACKed (trans_acked_bytes).</p>
<p>At the end of a collection interval, the capacity estimates for each congestion control algorithm are updated as follows. First, the average channel and transport peer receive rates are computed for the algorithm: </p><pre class="fragment">///   chan_recv_rate  = ((chan_acked_bytes * 8) / collection_interval)  (1)
///   trans_recv_rate = ((trans_acked_bytes * 8) / collection_interval) (2)
/// </pre><p> These peer receive rates are also aggregated for all algorithms into total channel and transport peer receive rates (total_chan_recv_rate and total_trans_recv_rate).</p>
<p>If the congestion window size is being used for estimating the capacity, then the last reported congestion window size for the algorithm in the current collection interval is compared with the last reported congestion window size for the algorithm at the end of the previous collection interval. If they are different by more than the largest packet size (1472 bytes), then the peer receive rate is close to the channel capacity and the peer receive rates computed above are saved as a capacity estimate candidate. Otherwise, if the total channel peer receive rate is greater than the most recent capacity estimate candidate's total channel peer receive rate, then the peer receive rates computed above are written into the most recent capacity estimate candidate. The two most recent capacity estimate candidates are stored at all times for the algorithm.</p>
<p>If the congestion window size is not being used for estimating the capacity, then the last reported rate estimate rate_est for the algorithm in the current collection interval is compared with the channel peer receive rate chan_recv_rate computed in (1) above in the current collection interval. If rate_est is close enough to chan_recv_rate (within 90% to 110% of chan_recv_rate), then the peer receive rate is close to the channel capacity and the peer receive rates computed above are saved as a capacity estimate candidate. Otherwise, if the total channel peer receive rate is greater than the capacity estimate candidate's total channel peer receive rate, then the peer receive rates computed above are written into the capacity estimate candidate. Only one capacity estimate candidate is stored for the algorithm.</p>
<p>The current connection capacity estimates at the end of each collection interval are the total peer receive rates (total_chan_recv_rate and total_trans_recv_rate) that contain the maximum total_chan_recv_rate value in all of the updated capacity estimate candidates.</p>
<p>If the current connection channel capacity estimate has changed enough since the last application report (either it has increased by any amount, or it has decreased by at least 10%) or enough time has passed since the last application report (4 seconds), then the current connection channel and transport capacity estimates should be reported to the application. The next collection interval then starts.</p>
<p>If the connection enters an outage at any time, then the connection channel and transport capacity estimates are both set to zero immediately. If the outage has just been entered, then the zero capacity estimates should be reported to the application immediately. Afterward, the zero capacity estimates must be reported to the application periodically (every 4 seconds). When the outage is over, a new collection interval is started and processing follows the normal update rules above. </p>

<p>Definition at line <a class="el" href="sliq__capacity__estimator_8h_source.html#l00140">140</a> of file <a class="el" href="sliq__capacity__estimator_8h_source.html">sliq_capacity_estimator.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a0d1c748a518227894d5c832d1bd37ed4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CapacityEstimator::InitCcAlg </td>
          <td>(</td>
          <td class="paramtype">CcId&#160;</td>
          <td class="paramname"><em>cc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>use_cwnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cwnd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a congestion control algorithm to be included in the capacity estimates. </p>
<p>If use_cwnd is true, then the congestion window size will be used to compute the capacity estimate in <a class="el" href="classsliq_1_1CapacityEstimator.html#a2214baf5bc7998465dc4e8eb9118c8a7" title="Update the capacity estimates. ">UpdateCapacityEstimate()</a>. If use_cwnd is false, then the congestion control rate estimate will be used in <a class="el" href="classsliq_1_1CapacityEstimator.html#a2214baf5bc7998465dc4e8eb9118c8a7" title="Update the capacity estimates. ">UpdateCapacityEstimate()</a> instead.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cc_id</td><td>The congestion control identifier. </td></tr>
    <tr><td class="paramname">use_cwnd</td><td>A flag indicating if the congestion window size should be used for creating the capacity estimate or not. </td></tr>
    <tr><td class="paramname">cwnd</td><td>The initial congestion window size, in bytes. Only used if use_cwnd is true.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the congestion control algorithm is initialized successfully, or false if not. </dd></dl>

<p>Definition at line <a class="el" href="sliq__capacity__estimator_8cc_source.html#l00141">141</a> of file <a class="el" href="sliq__capacity__estimator_8cc_source.html">sliq_capacity_estimator.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a6ba7e5d9ce8810bbbc3c7bbff97daedb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CapacityEstimator::Initialize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacesliq.html#a9122e87208b802ee4c4a25c9a786f2a5">EndptId</a>&#160;</td>
          <td class="paramname"><em>conn_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the capacity estimator. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conn_id</td><td>The connection identifier. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sliq__capacity__estimator_8cc_source.html#l00135">135</a> of file <a class="el" href="sliq__capacity__estimator_8cc_source.html">sliq_capacity_estimator.cc</a>.</p>

</div>
</div>
<a class="anchor" id="a2214baf5bc7998465dc4e8eb9118c8a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CapacityEstimator::UpdateCapacityEstimate </td>
          <td>(</td>
          <td class="paramtype">CcId&#160;</td>
          <td class="paramname"><em>cc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classiron_1_1Time.html">iron::Time</a> &amp;&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>app_payload_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes_sent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cwnd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>rate_est_bps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>in_outage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>chan_ce_bps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>trans_ce_bps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double &amp;&#160;</td>
          <td class="paramname"><em>ccl_time_sec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the capacity estimates. </p>
<p>This is called each time that one of the congestion control algorithms receives an ACK for a packet.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cc_id</td><td>The congestion control identifier of the algorithm that received the ACK. </td></tr>
    <tr><td class="paramname">now</td><td>The current time. </td></tr>
    <tr><td class="paramname">app_payload_bytes</td><td>The number of application payload bytes in the packet. </td></tr>
    <tr><td class="paramname">bytes_sent</td><td>The size of the SLIQ headers and payload sent, in bytes. </td></tr>
    <tr><td class="paramname">cwnd</td><td>The current congestion window size, in bytes. Only used if the congestion control algorithm was configured with use_cwnd set to true. </td></tr>
    <tr><td class="paramname">rate_est_bps</td><td>The current congestion control send rate estimate, in bits per second. Only used if the congestion control algorithm was configured with use_cwnd set to false. </td></tr>
    <tr><td class="paramname">in_outage</td><td>The current outage state. </td></tr>
    <tr><td class="paramname">chan_ce_bps</td><td>The resulting channel capacity estimate, in bps. Only set if the method returns true. </td></tr>
    <tr><td class="paramname">trans_ce_bps</td><td>The resulting transport capacity estimate, in bps. Only set if the method returns true. </td></tr>
    <tr><td class="paramname">ccl_time_sec</td><td>The amount of time, in seconds, since a congestion control limit event caused a capacity estimate update. Only set if the method returns true.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the capacity estimates should be reported back to the <a class="el" href="classsliq_1_1SliqApp.html" title="The base class for all SLIQ applications. ">SliqApp</a>, or false if not. </dd></dl>

<p>Definition at line <a class="el" href="sliq__capacity__estimator_8cc_source.html#l00188">188</a> of file <a class="el" href="sliq__capacity__estimator_8cc_source.html">sliq_capacity_estimator.cc</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/szabele/github/IRON/iron/sliq/src/<a class="el" href="sliq__capacity__estimator_8h_source.html">sliq_capacity_estimator.h</a></li>
<li>/home/szabele/github/IRON/iron/sliq/src/<a class="el" href="sliq__capacity__estimator_8cc_source.html">sliq_capacity_estimator.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesliq.html">sliq</a></li><li class="navelem"><a class="el" href="classsliq_1_1CapacityEstimator.html">CapacityEstimator</a></li>
    <li class="footer">Generated on Fri Feb 26 2021 11:31:59 for IRON by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
