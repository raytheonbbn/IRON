digraph sliq_copa3_onrttupdate {
    redy [ shape = ellipse, label = "Ready" ];
    blk1 [ shape = box,     label = "Set ts_delta = recv_ts - send_ts\nSet win_sec = max((20 * min_rtt), 10 seconds)\nDo min_ts_delta_state.DelayTrackerUpdate(ts_delta, ack_time, win_sec, min_ts_delta)\nSet adj_rtt = (rtt + min_ts_delta - ts_delta)\nSet old_local_min_rtt = local_min_rtt\nDo min_rtt_state.DelayTrackerUpdate(adj_rtt, ack_time, win_sec, local_min_rtt)" ];
    blk2 [ shape = box,     label = "Set adj_rtt = adj_rtt - anti_jitter\nSet adj_rtt = max(adj_rtt, local_min_rtt)" ];
    blk3 [ shape = box,     label = "Set srtt = ((SRTT_ALPHA * adj_rtt) + ((1 - SRTT_ALPHA) * srtt))\nSet srt_win_sec = 0.5 * srtt\nDo standing_rtt_state.DelayTrackerUpdate(adj_rtt, ack_time, srt_win_sec, standing_rtt)" ];
    blk4 [ shape = box,     label = "Set remote_min_rtt = HUGE_RTT" ];
    blk5 [ shape = box,     label = "Set min_rtt = min(local_min_rtt, remote_min_rtt)\nSet report_min_rtt = true" ];
    blk6 [ shape = box,     label = "Set queueing_delay = max((standing_rtt - min_rtt), 0)\nSet lambda_target = (1.0 / (delta * queueing_delay))\nSet lambda = (cwnd / standing_rtt)" ];
    blk7 [ shape = box,     label = "Set cwnd = (cwnd + (bytes / (NPS - DATA_HDR_BASE_SIZE)))" ];
    blk8 [ shape = box,     label = "Set state = CLOSED_LOOP" ];
    blk9 [ shape = box,     label = "Set rv = Do damper.DamperOnRttUpdate(queueing_delay, ist, delta)" ];
    blk10 [ shape = box,     label = "Set cwnd = cc_val\nDo velocity_state.VelocityReset(nxt_cc_seq, cwnd, (lambda <= lambda_target), velocity)" ];
    blk11 [ shape = box,     label = "Do velocity_state.VelocityUpdate(nxt_cc_seq, cwnd, (lambda <= lambda_target), velocity)" ];
    blk12 [ shape = box,     label = "Do velocity_state.VelocityReset(nxt_cc_seq, cwnd, (lambda <= lambda_target), velocity)\n" ];
    blk13 [ shape = box,     label = "Set velocity = min(velocity, (delta * cwnd))\nSet velocity = max(velocity, 1)\nSet cwnd_adj = ((bytes * velocity) / ((NPS - DATA_HDR_BASE_SIZE) * delta * cwnd))" ];
    blk14 [ shape = box,     label = "Set cwnd = cwnd + cwnd_adj" ];
    blk15 [ shape = box,     label = "Set cwnd = cwnd - cwnd_adj" ];
    blk16 [ shape = box,     label = "Set cwnd = max(cwnd, MIN_CWND)\nist = (standing_rtt / cwnd)\n" ];
    dsc1 [ shape = diamond, label = "Is state == SLOW_START OR\nstate == CLOSED_LOOP?" ];
    dsc2 [ shape = diamond, label = "Is anti_jitter > 0?" ];
    dsc3 [ shape = diamond, label = "Is local_min_rtt != old_local_min_rtt?" ];
    dsc4 [ shape = diamond, label = "Is ack_time >= (remote_min_rtt_time + win_sec)?" ];
    dsc5 [ shape = diamond, label = "Is state == SLOW_START?" ];
    dsc6 [ shape = diamond, label = "Is cwnd < INC_CWND_THRES OR\n(cwnd - (bif / (NPS - DATA_HDR_BASE_SIZE))) <= (INC_CWND_RATIO * cwnd)?" ];
    dsc7 [ shape = diamond, label = "Is lambda < lambda_target?" ];
    dsc8 [ shape = diamond, label = "Is rv == true?" ];
    dsc9 [ shape = diamond, label = "Does DamperCanUpdateVelCwnd\nstate machine return true?" ];
    dsc10 [ shape = diamond, label = "Is cc_seq >= velocity_state.start_cc_seq?" ];
    dsc11 [ shape = diamond, label = "Is (lambda <= lambda_target) != velocity_state.start_cwnd_increasing?" ];
    dsc12 [ shape = diamond, label = "Is lambda <= lambda_target?" ];
    dsc13 [ shape = diamond, label = "Is cwnd < INC_CWND_THRES OR\n(cwnd - (bif / (NPS - DATA_HDR_BASE_SIZE))) <= (INC_CWND_RATIO * cwnd)?" ];

    redy -> dsc1 [ label = "OnRttUpdate(ack_time, snd_ts, rcv_ts,\nseq, cc_seq, rtt, bytes, cc_val)" ];
    dsc1 -> blk1 [ label = "Yes" ];
    dsc1 -> redy [ label = "No" ];
    blk1 -> dsc2;
    dsc2 -> blk2 [ label = "Yes" ];
    dsc2 -> blk3 [ label = "No" ];
    blk2 -> blk3;
    blk3 -> dsc3
    dsc3 -> dsc4 [ label = "Yes" ];
    dsc3 -> blk6 [ label = "No" ];
    dsc4 -> blk4 [ label = "Yes" ];
    dsc4 -> blk5 [ label = "No" ];
    blk4 -> blk5;
    blk5 -> blk6;
    blk6 -> dsc5;
    dsc5 -> dsc6 [ label = "Yes" ];
    dsc5 -> blk9 [ label = "No" ];
    dsc6 -> blk7 [ label = "Yes" ];
    dsc6 -> dsc7 [ label = "No" ];
    blk7 -> dsc7;
    dsc7 -> blk8 [ label = "Yes" ];
    dsc7 -> blk16 [ label = "No" ];
    blk8 -> blk16;
    blk9 -> dsc8;
    dsc8 -> blk10 [ label = "Yes" ];
    dsc8 -> dsc9 [ label = "No" ];
    blk10 -> dsc9;
    dsc9 -> dsc10 [ label = "Yes" ];
    dsc9 -> blk16 [ label = "No" ];
    dsc10 -> blk11 [ label = "Yes" ];
    dsc10 -> dsc11 [ label = "No" ];
    blk11 -> dsc11;
    dsc11 -> blk12 [ label = "Yes" ];
    dsc11 -> blk13 [ label = "No" ];
    blk12 -> blk13;
    blk13 -> dsc12;
    dsc12 -> dsc13 [ label = "Yes" ];
    dsc12 -> blk15 [ label = "No" ];
    dsc13 -> blk14 [ label = "Yes" ];
    dsc13 -> blk16 [ label = "No" ];
    blk14 -> blk16;
    blk15 -> blk16;
    blk16 -> redy;
}
