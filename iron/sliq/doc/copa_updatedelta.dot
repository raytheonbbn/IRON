digraph sliq_copa_updatedelta {
    strt [ shape = ellipse, label = "Start" ];
    done [ shape = ellipse, label = "Done" ];
    blk1 [ shape = box,     label = "Set rtt_ewma = max(rtt_acked, rtt_nacked)\nSet target_time = (prev_delta_update_time + min((PC_RTTS * rtt_ewma), PC_MAX_INT)" ];
    blk2 [ shape = box,     label = "Set target_delta = local_sync_delta\nSet allow_sync = true" ];
    blk3 [ shape = box,     label = "Set allow_sync = false" ];
    blk4 [ shape = box,     label = "Set target_delta = (calc_intersend_time / min_rtt)" ];
    blk5 [ shape = box,     label = "Set target_delta = (local_sync_delta + PC_ADD_INC)" ];
    blk6 [ shape = box,     label = "Set target_delta = (local_sync_delta * PC_MULT_DEC)" ];
    blk7 [ shape = box,     label = "Set target_delta = local_sync_delta" ];
    blk8 [ shape = box,     label = "Set target_delta = min(max(target_delta, MIN_DELTA), MAX_DELTA)\nQuantize target_delta to nearest 0.0001\nSet local_sync_delta = target_delta" ];
    blk9 [ shape = box,     label = "Set delta = local_sync_delta" ];
    blk10 [ shape = box,     label = "Set param = (int)(delta * 10000)" ];
    blk11 [ shape = box,     label = "Set sync_param = param\nSet prev_sync_param = param\nSet prev_sync_time = now" ];
    blk12 [ shape = box,     label = "Set delta = remote_sync_delta" ];
    blk13 [ shape = box,     label = "Set delta = local_sync_delta" ];
    blk14 [ shape = box,     label = "Set prev_delta_update_time = now\nSet send_cnt = 0\nSet quiescent_cnt = 0" ];
    dsc1 [ shape = diamond, label = "Is mode == CONSTANT_DELTA?" ];
    dsc2 [ shape = diamond, label = "Is now < target_time?" ];
    dsc3 [ shape = diamond, label = "Is send_cnt == 0 OR\nquiescent_cnt > 0?" ];
    dsc4 [ shape = diamond, label = "Is target_delta > (delta + PC_ADD_INC)?" ];
    dsc5 [ shape = diamond, label = "Is target_delta < (delta * PC_MULT_DEC)?" ];
    dsc6 [ shape = diamond, label = "Is endpoint the client side?" ];
    dsc7 [ shape = diamond, label = "Is allow_sync == true?" ];
    dsc8 [ shape = diamond, label = "Is param != prev_sync_param OR\nnow >= (prev_sync_time + PC_SYNC_INT)" ];
    dsc9 [ shape = diamond, label = "Is remote_sync_delta > 0.0 AND\nnow <= (prev_sync_time + (3 * PC_SYNC_INT)) AND\nabs(remote_sync_delta - local_sync_delta) <= PC_SYNC_THRESH?" ];

    strt -> dsc1 [ label = "UpdateDelta(pkt_lost)" ];
    dsc1 -> done [ label = "Yes" ];
    dsc1 -> blk1 [ label = "No" ];
    blk1 -> dsc2;
    dsc2 -> done [ label = "Yes" ];
    dsc2 -> blk2 [ label = "No" ];
    blk2 -> dsc3;
    dsc3 -> blk3 [ label = "Yes" ];
    dsc3 -> blk4 [ label = "No" ];
    blk3 -> blk7;
    blk4 -> dsc4;
    dsc4 -> blk5 [ label = "Yes" ];
    dsc4 -> dsc5 [ label = "No" ];
    dsc5 -> blk6 [ label = "Yes" ];
    dsc5 -> blk7 [ label = "No" ];
    blk5 -> blk8;
    blk6 -> blk8;
    blk7 -> blk8;
    blk8 -> dsc6;
    dsc6 -> blk9 [ label = "Yes" ];
    dsc6 -> dsc9 [ label = "No" ];
    blk9 -> dsc7;
    dsc7  -> blk10 [ label = "Yes" ];
    dsc7  -> blk14 [ label = "No" ];
    blk10 -> dsc8;
    dsc8  -> blk11 [ label = "Yes" ];
    dsc8  -> blk14 [ label = "No" ];
    blk11 -> blk14;
    dsc9  -> blk12 [ label = "Yes" ];
    dsc9  -> blk13 [ label = "No" ];
    blk12 -> blk14;
    blk13 -> blk14;
    blk14 -> done;
}
